<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
        "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
      <title>商品详情</title>
      <link rel="stylesheet" href="../css/goodDetails.css"/>
      <link rel="stylesheet" href="../css/font-awesome.min.css"/>
      <link rel="stylesheet" href="../css/ShopShow.css" type="text/css" />
      <link rel="stylesheet" href="../css/MagicZoom.css" type="text/css" />
    <link rel="stylesheet" href="css/yewei.css"/>
      <link rel="stylesheet" href="css/index.css"/>
</head>
<body>
<div id="wrapper">
    <header id="header">
        <%- include head.html %>
        <div id="username">tian</div>
        <span class="addOne">+1</span>
    </header><!--header end-->
    <div id="content">
        <div id="ct_container">
            <% if(datas[0]=="花"){ %>
            <div id="typeId" style="display: none;"><%= datas[1].flower_id %></div>
            <div id="tsShopContainer">
                <div id="tsImgS"><a href="<%= datas[1].flower_src %>" title="Images" id="MagicZoom"
                                       id="MagicZoom"><img width="300" height="300" src="<%= datas[1].flower_src %>" id="bigImg"/></a></div>
            <% }else if(datas[0]=="礼盒"){ %>
                <div class="typeId"><%= datas[1].gift_id %></div>
                <div class="tsShopContainer">
                    <div class="tsImgS"><a href="<%= datas[1].gift_src %>" title="Images" class="MagicZoom"
                                           class="MagicZoom"><img width="300" height="300" src="<%= datas[1].gift_src %>" class="bigImg"/></a></div>
            <% }else if(datas[0]=="盆栽"){ %>
                    <div class="typeId"><%= datas[1].potted_id %></div>
                    <div class="tsShopContainer">
                        <div class="tsImgS"><a href="<%= datas[1].potted_src %>" title="Images" class="MagicZoom"
                                               class="MagicZoom"><img width="300" height="300" src="<%= datas[1].potted_src %>" class="bigImg"/></a></div>
            <% }else if(datas[0]=="包装纸"){ %>
                        <div class="typeId"><%= datas[1].wrapper_id %></div>
                        <div class="tsShopContainer">
                            <div class="tsImgS"><a href="<%= datas[1].wrapper_src %>" title="Images" class="MagicZoom"
                                                   class="MagicZoom"><img width="300" height="300" src="<%= datas[1].wrapper_src %>" class="bigImg"/></a></div>

            <% } %>

                <div id="tsPicContainer">
                    <div id="tsImgSArrL" onclick="tsScrollArrLeft()"></div>
                    <div id="tsImgSCon">
                        <ul>
                            <li onclick="showPic(0)" rel="MagicZoom" class="tsSelectImg"><img height="42" width="42" src="../images/goodDetails/1.jpg" tsImgS="../images/goodDetails/1.jpg" /></li>
                            <li onclick="showPic(1)" rel="MagicZoom"><img height="42" width="42" src="../images/goodDetails/11.jpg" tsImgS="../images/goodDetails/11.jpg" /></li>
                            <li onclick="showPic(2)" rel="MagicZoom"><img height="42" width="42" src="../images/goodDetails/2.jpg" tsImgS="../images/goodDetails/2.jpg" /></li>
                            <li onclick="showPic(3)" rel="MagicZoom"><img height="42" width="42" src="../images/goodDetails/3.jpg" tsImgS="../images/goodDetails/3.jpg" /></li>
                            <li onclick="showPic(4)" rel="MagicZoom"><img height="42" width="42" src="../images/goodDetails/14.jpg" tsImgS="../images/goodDetails/14.jpg" /></li>
                            <li onclick="showPic(5)" rel="MagicZoom"><img height="42" width="42" src="../images/goodDetails/15.jpg" tsImgS="../images/goodDetails/15.jpg" /></li>
                            <li onclick="showPic(6)" rel="MagicZoom"><img height="42" width="42" src="../images/goodDetails/4.jpg" tsImgS="../images/goodDetails/4.jpg" /></li>
                            <li onclick="showPic(7)" rel="MagicZoom"><img height="42" width="42" src="../images/goodDetails/17.jpg" tsImgS="../images/goodDetails/17.jpg" /></li>
                            <li onclick="showPic(8)" rel="MagicZoom"><img height="42" width="42" src="../images/goodDetails/18.jpg" tsImgS="../images/goodDetails/18.jpg" /></li>
                            <li onclick="showPic(9)" rel="MagicZoom"><img height="42" width="42" src="../images/goodDetails/5.jpg" tsImgS="../images/goodDetails/5.jpg" /></li>
                            <li onclick="showPic(10)" rel="MagicZoom"><img height="42" width="42" src="../images/goodDetails/6.jpg" tsImgS="../images/goodDetails/6.jpg" /></li>
                        </ul>
                    </div>
                    <div id="tsImgSArrR" onclick="tsScrollArrRight()"></div>
                </div><!--tsPicContainer end-->

                <img class="MagicZoomLoading" width="16" height="16" src="../images/goodDetails/loading.gif" alt="Loading..." />
            </div>
        <div class="ct_right">
            <% if(datas[0]=="花"){ %>
                <h2 class="des"><%= datas[1].flower_describe %></h2>
                <p class="info">颜色：<span class="goodColor"><%= datas[1].flower_color %></span></p>
                <p class="info">类型：<span class="goodName"><%= datas[1].flower_name %></span></p>
                <p class="info">价格：<span class="goodPrice">￥<%= datas[1].flower_price %></span></p>
            <% }else if(datas[0]=="礼盒"){ %>
                <h2 class="des"><%= datas[1].gift_describe %></h2>
                <p class="info">颜色：<span class="goodColor"><%= datas[1].gift_color %></span></p>
                <p class="info">大小：<span class="goodSize"><%= datas[1].gift_color %></span></p>
                <p class="info">类型：<span class="goodName"><%= datas[1].gift_name %></span></p>
                <p class="info">价格：<span class="goodPrice">￥<%= datas[1].gift_price %></span></p>
            <% }else if(datas[0]=="盆栽"){ %>
                <h2 class="des"><%= datas[1].potted_describe %></h2>
                <p class="info">类型：<span class="goodName"><%= datas[1].potted_name %></span></p>
                <p class="info">价格：<span class="goodPrice">￥<%= datas[1].potted_price %></span></p>
            <% }else if(datas[0]=="包装纸"){ %>
                <h2 class="des"><%= datas[1].wrapper_describe %></h2>
                <p class="info">颜色：<span class="goodColor"><%= datas[1].wrapper_color %></span></p>
                <p class="info">类型：<span class="goodName"><%= datas[1].wrapper_name %></span></p>
                <p class="info">价格：<span class="goodPrice">￥<%= datas[1].wrapper_price %></span></p>
            <% } %>
            <p>
                <span class="reduceNum">-</span>
                <input type="text" class="count" value="1" onchange="checkNum(this);"/>
                <span class="plusNum">+</span>
            </p>
            <p class="operate">
                <button type="button" onclick="addCart();">加入购物车</button>
                <img src="../images/goodDetails/6.jpg" class="smallImg" style="z-index:99999"/>
                <button type="button"><a href="orderSubmit.html">立即购买</a></button>
            </p>
          <!--  <p> <span class="fa fa-plus-square"> 关注</span></p>-->
          <!--  <p><span class="fa fa-heart" id="addColl"> 收藏</span></p>-->
            <p class="contact"><span class="fa fa-phone"></span>&nbsp;<span>400-0814-520</span>
                <span class="fa fa-file"></span>&nbsp;<span>support@hua.li</span>
            </p>
            <p class="transport">运输说明</p>
            <p>周末及法定节假日只接单不发货。</p>
            <p>本商品仅配送成都以内地区，具体送达时间以实际物流为准，如需更改时间请提前一个工作日。</p>
            <p>在您完成支付后，您可以查看物流状态，也会接收到短信提示。</p>
          </div><!--ct_right end-->
        </div><!--ct_container end-->
     </div><!--content end-->
    <footer id="footer">
        <%- include foot.html %>
    </footer><!--footer end-->
    <div id="successAddCart"><p>宝贝已加入购物车</p><a href="shoppingCart.html">去购物车查看</a></div>
    <div id="alreadyCollect"><p>宝贝已收藏过了</p></div>
    <div id="successCollect"><p>收藏成功</p></div>
</div><!--wrapper end-->

<!--<script src="../js/checkLoginStatus.js"></script>-->
<script src="../js/MagicZoom.js" type="text/javascript"></script>
<script src="../js/ShopShow.js"></script>
<script>
    var addColl = document.getElementById("addColl");
    var type_id = document.getElementById("typeId").innerHTML;
    var uname = document.getElementById("username").innerHTML;
    var smallImg = document.getElementsByClassName("smallImg");
    var addOne = document.getElementsByClassName("addOne");
    var reduceBtn = document.getElementsByClassName("reduceNum");
    var count = document.getElementsByClassName("count");
    var plusNum = document.getElementsByClassName("plusNum");
    var successAddCart = document.getElementById("successAddCart");
    var alreadyCollect = document.getElementById("alreadyCollect");
    var successCollect =  document.getElementById("successCollect");
    /*==================添加收藏====================*/
   /* if(document.addEventListener){
        addColl.addEventListener("click",addCollection,true);
    }else{
        addColl.attachEvent("onclick",addCollection);
    }
    function addCollection(){
        var xhr;
        if(window.ActiveXObject){
            xhr = new ActiveXObject("Microsoft.XMLHTTP");
        }else{
            xhr = new XMLHttpRequest();
        }
        xhr.open("post","/collection.do",true);
        xhr.setRequestHeader("content-type","application/x-www-form-urlencoded");
        xhr.onreadystatechange=function(){
            if(xhr.readyState==4&& xhr.status==200) {
                var data = xhr.responseText;
                console.log("添加收藏的时候，如果已收藏，那么返回的data:" + data);
                if (data == "error"){
                    alreadyCollect.style.display="block";
                    setTimeout(function(){
                        alreadyCollect.style.display="";
                    },2000);
                }else if(data=="ok"){
                    successCollect.style.display="block";
                    setTimeout(function(){
                        successCollect.style.display="";
                    },2000);
                }
            }else{
                console.log("获取数据失败");
            }
        }
        console.log("在添加收藏之前，检查页面中获取到得type_id");
        xhr.send("uname="+uname+"&type_id="+type_id);
    }*/
    /*==============立即加入购物车================*/
    function addCart(){
        var e = window.event || arguments[0];
        var xhr;
        if(window.ActiveXObject){
            xhr = new ActiveXObject("Microsoft.XMLHTTP");
        }else{
            xhr = new XMLHttpRequest();
        }
        xhr.open("post","/addCart.do",true);
        xhr.setRequestHeader("content-type","application/x-www-form-urlencoded");
        xhr.onreadystatechange=function(){
            if(xhr.readyState==4&&xhr.status==200){
                var data=xhr.responseText;
                if(data=="ok"){
                    successAddCart.style.display="block";
                    setTimeout(function(){
                        successAddCart.style.display="";
                    },3000);
                    moveImg(e);
                }else{
                    successAddCart.style.display="";
                }
            }
        }
        //需要的数据 商品详情（flower_src,flower_describe,flower_price,number,allMoney）
        xhr.send("number="+count[0].value+"&uname="+uname);
    }
    function moveImg(e){
        var x = e.clientX;
        var y = e.clientY;
        console.log("x,y:"+x+"\t"+y);
        console.log("获取到的缩略图："+smallImg[0].src);
        console.log("获取到的+1"+addOne[0].innerHTML);
        /*====先让缩略图显示======*/
        smallImg[0].style.display="block";
        setTimeout(function(){
           /* smallImg[0].style.animation="moveSmallImg 2s linear";*/
            smallImg[0].style.top="20px";
            smallImg[0].style.right="30px";
            smallImg[0].style.webkitTransition="all 3s linear";
            smallImg[0].style.opacity="0";
        },1000);
        setTimeout(function(){
            addOne[0].style.webkitAnimation="changeOpacity 1s linear";
            smallImg[0].style.top="330px";
            smallImg[0].style.right="520px";
            smallImg[0].style.opacity="1";
            smallImg[0].style.display="";
            setTimeout(function(){
                addOne[0].style.webkitAnimation="";
            },1000);
        },3000);
    }

    /*==========控制数量加减============*/
    function checkNum(obj){//检查手动输入的number有效性
        var a=/^[1-9]\d*$/;
        var b=obj.value;
        if(!a.test(b)){
            obj.value=1;
        }
    }
    if (document.addEventListener) {
        reduceBtn[0].addEventListener("click", reduceNum,true);
        plusNum[0].addEventListener("click",addNum,true);
    }
    else{
        reduceBtn[0].addEventListener("onclick", reduceNum);
        plusNum[0].addEventListener("onclick", addNum);
    }
    function reduceNum(){
        if (count[0].value == 1) {
            count[0].value = 1;
        } else {
            count[0].value = Number(count[0].value) - 1;
        }
    }
    function addNum(){
       count[0].value = Number(count[0].value) + 1;
    }
</script>
<script src="js/index.js"></script>
<script src="js/fenxiang.js"></script>
<script src="../js/checkLogStatus.js"></script>
</body>
</html>